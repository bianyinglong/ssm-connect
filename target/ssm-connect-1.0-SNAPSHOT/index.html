<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta http-equiv="X-UA-Compatible" content="IE=edge">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Document</title>    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/element-plus/dist/index.css" />    <script src="//unpkg.com/vue@next"></script>    <script src="//unpkg.com/element-plus"></script>    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>    <script src="./ssm-request.js"></script>    <style>        #app {            width: 100vw;            height: 100vh;        }        .container {            display: flex;            width: 100%;            height: 100%;            flex-direction: column;            align-items: center;            /* justify-content: center; */        }        .pagination {            padding-top: 20px;        }        .addEmpBtn {            width: 100%;            text-align: right;            margin-right: 35%;            margin-bottom: 10px;        }    </style></head><body><div id="app">    <h1 style="text-align: center;">SSM整合项目</h1>    <div class="container">        <div class="addEmpBtn">            <el-button type="primary" @click="addClick">{{isEdit ? '编辑':'添加'}}员工</el-button>            <el-button type="danger" @click="handleBatchDelete" :disabled="deleteIds.length==0">批量删除</el-button>        </div>        <el-table :data="tableData" :border="true" @selection-change="handleSelectionChange" stripe max-height="620"                  style="width:70%;">            <el-table-column type="selection" width="55"></el-table-column>            <el-table-column type="index" width="50" :align="'center'"></el-table-column>            <el-table-column prop="empName" label="姓名" width="180"></el-table-column>            <el-table-column prop="empGender" label="性别" width="180" :formatter="genderFormatter">            </el-table-column>            <el-table-column prop="empEmail" label="邮箱"></el-table-column>            <el-table-column label="所在部门">                <template #default="scope">                    <pre>{{scope.row.dept.deptName}}</pre>                </template>            </el-table-column>            <el-table-column label="操作">                <template #default="scope">                    <el-button size="small" @click="handleEdit(scope.$index, scope.row)">编辑</el-button>                    <el-button size="small" type="danger" @click="handleDelete(scope.$index, scope.row)">删除</el-button>                </template>            </el-table-column>        </el-table>        <el-pagination class="pagination" small background layout="total, sizes, prev, pager, next, jumper" :total="total"                       :page-sizes="[5,10,15]" v-model:currentPage="currentPage" v-model:page-size="pageSize"                       @current-change="hanleCurrentChange" @size-change="handleSizeChange"></el-pagination>    </div>    <el-dialog v-model="dialogVisible" :title="isEdit ? '编辑员工' :'添加员工'" width="40%">        <el-form :model="form" ref="formRef">            <el-form-item prop="empName" label="姓名" label-width="80" :rules="[        { required: true, message: '请输入姓名' },        { type: 'string', message: '姓名不合法' },      ]">                <el-input v-model="form.empName" placeholder="请输入姓名" autocomplete="off" />            </el-form-item>            <el-form-item prop="empGender" label="性别" label-width="80" required>                <el-radio-group v-model="form.empGender">                    <el-radio label="M">男</el-radio>                    <el-radio label="F">女</el-radio>                </el-radio-group>            </el-form-item>            <el-form-item prop="empEmail" label="邮箱" label-width="80">                <el-input v-model="form.empEmail" placeholder="请输入邮箱" autocomplete="off" />            </el-form-item>            <el-form-item prop="deptId" label="所属部门" label-width="100">                <el-select v-model="form.deptId" placeholder="请选择部门">                    <el-option v-for="item in deptList" :key="item.deptId" :label="item.deptName" :value="item.deptId">                    </el-option>                </el-select>            </el-form-item>        </el-form>        <template #footer>        <span class="dialog-footer">          <el-button @click="handleAddCancel(formRef)">取消</el-button>          <el-button type="primary" @click="submitForm(formRef)">确定</el-button>        </span>        </template>    </el-dialog></div></body><script>    const { createApp, ref, reactive, onMounted, nextTick } = Vue;    const { ElMessage, zhCn } = ElementPlus    const configuration = {        setup() {            const currentPage = ref(1);            const pageSize = ref(5);            const total = ref(0)            const dialogVisible = ref(false)            const tableData = ref([]);            const form = reactive({                empName: '',                empGender: '',                empEmail: '',                deptId: ''            })            const isEdit = ref(false)            const editId = ref(0)            const deleteIds = ref([])            const getAllEmps = async () => {                const { data } = await instance.get('/emps', {                    params: { pageNum: currentPage.value, pageSize: pageSize.value }                })                tableData.value = data.list;                currentPage.value = data.pageNum;                pageSize.value = data.pageSize;                total.value = data.total;            }            const deptList = ref([])            const getAllDept = async () => {                const { data } = await instance.get('/dept');                deptList.value = data            }            onMounted(() => {                getAllEmps()                getAllDept()            })            const genderFormatter = (row, col) => {                return row.empGender === 'M' ? '男' : '女'            }            const addClick = () => {                isEdit.value = false;                dialogVisible.value = true;                formRef.value.resetFields()            }            const handleEdit = (index, row) => {                dialogVisible.value = true;                isEdit.value = true;                // 赋值操作一定要放在nextTick中，否则resetFields重置表单会失效                nextTick(() => {                    form.empName = row.empName                    form.empGender = row.empGender                    form.empEmail = row.empEmail;                form.deptId = row.deptId                editId.value = row.empId            })            }            const handleDelete = (index, row) => {                instance.delete(`/emps/${row.empId}`).then(res => {                    if (res.code === 200) {                    getAllEmps()                    ElMessage.success('删除成功')                }            })            }            const handleBatchDelete = () => {                console.log(deleteIds.value)                instance.delete('/emps/batch', {                    data: { ids: deleteIds.value }                }).then(res => {                    if (res.code === 200) {                    getAllEmps()                    ElMessage.success('批量删除成功')                }            })            }            const hanleCurrentChange = (val) => {                currentPage.value = val                getAllEmps()            }            const handleSizeChange = (val) => {                pageSize.value = val;                getAllEmps()            }            const formRef = ref(null)            const submitForm = async (formRef) => {                if (!formRef) return                await formRef.validate(async (valid, fields) => {                    if (valid) {                        if (isEdit.value) {                            await instance.put(`/emps/${editId.value}`, { ...form })                        } else {                            await instance.post('/emps', { ...form })                        }                        await getAllEmps()                    } else {                        console.log('error submit!', fields)                    }                })                formRef.resetFields()                dialogVisible.value = false;            }            const handleAddCancel = (formRef) => {                formRef.resetFields()                dialogVisible.value = false;                isEdit.value = false            }            const handleSelectionChange = (val) => {                const ids = val.map(item => item.empId)                deleteIds.value = ids            }            return {                tableData, currentPage, pageSize, total, dialogVisible, form, formRef,                deptList,                isEdit,                addClick,                handleAddCancel,                handleSelectionChange,                deleteIds,                handleBatchDelete,                submitForm, genderFormatter, handleEdit, handleDelete, hanleCurrentChange, handleSizeChange            }        }    };    createApp(configuration).use(ElementPlus).mount(document.getElementById("app"));</script></html>